"use strict";function liquidFillGaugeDefaultSettings(){return{minValue:0,maxValue:100,circleThickness:.05,circleFillGap:.05,circleColor:"#178BCA",waveHeight:.05,waveCount:1,waveRiseTime:1e3,waveAnimateTime:18e3,waveRise:!0,waveHeightScaling:!0,waveAnimate:!0,waveColor:"#178BCA",waveOffset:0,textVertPosition:.5,textSize:1,valueCountUp:!0,displayPercent:!0,textColor:"#045681",waveTextColor:"#A4DBf8"}}function loadLiquidFillGauge(a,b,c){function d(){M.attr("transform","translate("+F(M.attr("T"))+",0)"),M.transition().duration(c.waveAnimateTime*(1-M.attr("T"))).ease("linear").attr("transform","translate("+F(1)+",0)").attr("T",1).each("end",function(){M.attr("T",0),d(c.waveAnimateTime)})}function e(){this.update=function(a){var b=parseFloat(a).toFixed(2),e=function(a){return Math.round(a)};parseFloat(b)!==parseFloat(e(b))&&(e=function(a){return parseFloat(a).toFixed(1)}),parseFloat(b)!==parseFloat(e(b))&&(e=function(a){return parseFloat(a).toFixed(2)});var g=function(){var b=d3.interpolate(this.textContent,parseFloat(a).toFixed(2));return function(a){this.textContent=e(b(a))+o}};J.transition().duration(c.waveRiseTime).tween("text",g),O.transition().duration(c.waveRiseTime).tween("text",g);var h,i=Math.max(c.minValue,Math.min(c.maxValue,a))/c.maxValue,j=s*f(100*i),k=d3.scale.linear().range([r+2*s+j,r-j]).domain([0,1]),l=k(i),m=d3.scale.linear().range([0,w]).domain([0,1]),n=d3.scale.linear().range([0,j]).domain([0,1]);h=c.waveHeightScaling?d3.svg.area().x(function(a){return m(a.x)}).y0(function(a){return n(Math.sin(2*Math.PI*c.waveOffset*-1+2*Math.PI*(1-c.waveCount)+2*a.y*Math.PI))}).y1(function(a){return 2*s+j}):K;var p=c.waveAnimate?F(1):0;M.transition().duration(0).transition().duration(c.waveAnimate?c.waveAnimateTime*(1-M.attr("T")):c.waveRiseTime).ease("linear").attr("d",h).attr("transform","translate("+p+",0)").attr("T","1").each("end",function(){c.waveAnimate&&(M.attr("transform","translate("+F(0)+",0)"),d(c.waveAnimateTime))}),L.transition().duration(c.waveRiseTime).attr("transform","translate("+Q+","+l+")")}}null===c&&(c=liquidFillGaugeDefaultSettings());var f,g=d3.select("#"+a),h=Math.min(parseInt(g.style("width")),parseInt(g.style("height")))/2,i=parseInt(g.style("width"))/2-h,j=parseInt(g.style("height"))/2-h,k=Math.max(c.minValue,Math.min(c.maxValue,b))/c.maxValue;f=c.waveHeightScaling?d3.scale.linear().range([0,c.waveHeight,0]).domain([0,50,100]):d3.scale.linear().range([c.waveHeight,c.waveHeight]).domain([0,100]);var l=c.textSize*h/2,m=parseFloat(b).toFixed(2),n=c.valueCountUp?c.minValue:m,o=c.displayPercent?"%":"",p=c.circleThickness*h,q=c.circleFillGap*h,r=p+q,s=h-r,t=s*f(100*k),u=2*s/c.waveCount,v=1+c.waveCount,w=u*v,x=function(a){return Math.round(a)};parseFloat(m)!==parseFloat(x(m))&&(x=function(a){return parseFloat(a).toFixed(1)}),parseFloat(m)!==parseFloat(x(m))&&(x=function(a){return parseFloat(a).toFixed(2)});for(var y=[],z=0;40*v>=z;z++)y.push({x:z/(40*v),y:z/40});var A=d3.scale.linear().range([0,2*Math.PI]).domain([0,1]),B=d3.scale.linear().range([0,h]).domain([0,h]),C=d3.scale.linear().range([0,w]).domain([0,1]),D=d3.scale.linear().range([0,t]).domain([0,1]),E=d3.scale.linear().range([r+2*s+t,r-t]).domain([0,1]),F=d3.scale.linear().range([0,w-2*s]).domain([0,1]),G=d3.scale.linear().range([r+2*s,r+.7*l]).domain([0,1]),H=g.append("g").attr("transform","translate("+i+","+j+")"),I=d3.svg.arc().startAngle(A(0)).endAngle(A(1)).outerRadius(B(h)).innerRadius(B(h-p));H.append("path").attr("d",I).style("fill",c.circleColor).attr("transform","translate("+h+","+h+")");var J=H.append("text").text(x(n)+o).attr("class","liquidFillGaugeText").attr("text-anchor","middle").attr("font-size",l+"px").style("fill",c.textColor).attr("transform","translate("+h+","+G(c.textVertPosition)+")"),K=d3.svg.area().x(function(a){return C(a.x)}).y0(function(a){return D(Math.sin(2*Math.PI*c.waveOffset*-1+2*Math.PI*(1-c.waveCount)+2*a.y*Math.PI))}).y1(function(a){return 2*s+t}),L=H.append("defs").append("clipPath").attr("id","clipWave"+a),M=L.append("path").datum(y).attr("d",K).attr("T",0),N=H.append("g").attr("clip-path","url("+location.href+"#clipWave"+a+")");N.append("circle").attr("cx",h).attr("cy",h).attr("r",s).style("fill",c.waveColor);var O=N.append("text").text(x(n)+o).attr("class","liquidFillGaugeText").attr("text-anchor","middle").attr("font-size",l+"px").style("fill",c.waveTextColor).attr("transform","translate("+h+","+G(c.textVertPosition)+")");if(c.valueCountUp){var P=function(){var a=d3.interpolate(this.textContent,m);return function(b){this.textContent=x(a(b))+o}};J.transition().duration(c.waveRiseTime).tween("text",P),O.transition().duration(c.waveRiseTime).tween("text",P)}var Q=r+2*s-w;return c.waveRise?L.attr("transform","translate("+Q+","+E(0)+")").transition().duration(c.waveRiseTime).attr("transform","translate("+Q+","+E(k)+")").each("start",function(){M.attr("transform","translate(1,0)")}):L.attr("transform","translate("+Q+","+E(k)+")"),c.waveAnimate&&d(),new e}angular.module("foobotApp",["ngCookies","ngResource","ngSanitize","ui.router","gettext"]).config(["$stateProvider","$urlRouterProvider","$resourceProvider","$locationProvider","$httpProvider",function(a,b,c,d,e){b.otherwise("/"),d.html5Mode(!0),c.defaults.stripTrailingSlashes=!1,e.interceptors.push("authInterceptor")}]).factory("authInterceptor",["$rootScope","$q","$cookieStore","$location",function(a,b,c,d){return{request:function(a){return a.headers=a.headers||{},c.get("token")&&(a.headers["X-AUTH-TOKEN"]=c.get("token")),a},responseError:function(a){return 401===a.status?(d.path("/login"),c.remove("token"),b.reject(a)):b.reject(a)}}}]).run(["$rootScope","$location","Auth","gettextCatalog",function(a,b,c,d){var e=window.navigator.userLanguage||window.navigator.language;moment.locale(e),d.setCurrentLanguage(e.substr(0,2)),a.$on("$stateChangeStart",function(a,d){c.isLoggedInAsync(function(c){d.authenticate&&!c&&(a.preventDefault(),b.path("/login"))})})}]),angular.module("foobotApp").config(["$stateProvider",function(a){a.state("login",{url:"/login",templateUrl:"app/account/login/login.html",controller:"LoginCtrl"}).state("signup",{url:"/signup",templateUrl:"app/account/signup/signup.html",controller:"SignupCtrl"}).state("settings",{url:"/settings",templateUrl:"app/account/settings/settings.html",controller:"SettingsCtrl",authenticate:!0})}]),angular.module("foobotApp").controller("LoginCtrl",["$scope","Auth","$location",function(a,b,c){a.user={},a.errors={},a.login=function(d){a.submitted=!0,d.$valid&&b.login({email:a.user.email,password:a.user.password}).then(function(){c.path("/")})["catch"](function(b){a.errors.other=b.message})}}]),angular.module("foobotApp").controller("SettingsCtrl",["$scope","User","Auth",function(a,b,c){a.errors={},a.changePassword=function(b){a.submitted=!0,b.$valid&&c.changePassword(a.user.oldPassword,a.user.newPassword).then(function(){a.message="Password successfully changed."})["catch"](function(){b.password.$setValidity("dbmodel",!1),a.errors.other="Incorrect password",a.message=""})}}]),angular.module("foobotApp").controller("SignupCtrl",["$scope","Auth","$location",function(a,b,c){a.user={},a.errors={},a.register=function(d){a.submitted=!0,d.$valid&&b.createUser({name:a.user.name,email:a.user.email,password:a.user.password}).then(function(){c.path("/")})["catch"](function(b){b=b.data,a.errors={},angular.forEach(b.errors,function(b,c){d[c].$setValidity("dbmodel",!1),a.errors[c]=b.message})})}}]),angular.module("foobotApp").controller("AdminCtrl",["$scope","$http","Auth","User",function(a,b,c,d){a.users=d.query(),a["delete"]=function(b){d.remove({id:b.id}),angular.forEach(a.users,function(c,d){c===b&&a.users.splice(d,1)})}}]),angular.module("foobotApp").config(["$stateProvider",function(a){a.state("admin",{url:"/admin",templateUrl:"app/admin/admin.html",controller:"AdminCtrl"})}]),angular.module("foobotApp").controller("DevicesCtrl",["$scope","$http","$state","$stateParams","Data","Graph",function(a,b,c,d,e,f){e.get({uuid:d.deviceUuid,period:0,sampling:0},function(b){for(var c=0;c<b.sensors.length;c++)"time"===b.sensors[c]?a[b.sensors[c]]=moment.unix(b.datapoints[0][c]).fromNow():(a[b.sensors[c]]={},a[b.sensors[c]].value=b.datapoints[0][c],a[b.sensors[c]].unit=b.units[c])},function(a){console.log("Impossible de récupérer les données "+a)}),f.get({uuid:d.deviceUuid,start:moment().subtract(7,"days").toISOString(),end:moment().toISOString(),sampling:0},function(b){a.graphData=b.datapoints},function(a){console.log("Impossible de récupérer les données "+a)})}]),angular.module("foobotApp").config(["$stateProvider",function(a){a.state("devices",{url:"/devices/{deviceUuid}",templateUrl:"app/devices/devices.html",controller:"DevicesCtrl"})}]),angular.module("foobotApp").controller("MainCtrl",function(){}),angular.module("foobotApp").config(["$stateProvider",function(a){a.state("main",{url:"/",templateUrl:"app/main/main.html",controller:"MainCtrl"})}]),angular.module("foobotApp").factory("Auth",["$location","$rootScope","$http","User","$cookieStore","$q",function(a,b,c,d,e,f){var g={};return e.get("token")&&(g.name=localStorage.getItem("username")),{login:function(a,b){var d=b||angular.noop,h=f.defer();return c.get("/api/v2/user/"+a.email+"/login/",{headers:{Authorization:"Basic "+window.btoa(unescape(encodeURIComponent(a.email+":"+a.password)))}}).success(function(b,c,f){return b?(e.put("token",f("X-AUTH-TOKEN")),a.name=a.email,localStorage.setItem("username",a.name),g=a,h.resolve(b),d()):void h.reject({message:"Unable to log in."})}).error(function(a){return this.logout(),h.reject(a),d(a)}.bind(this)),h.promise},logout:function(){e.remove("token"),localStorage.removeItem("username"),g={}},createUser:function(a,b){var c=b||angular.noop;return a.id=a.email,d.create(a,function(b,d){return e.put("token",d("X-AUTH-TOKEN")),g.name=b.username,localStorage.setItem("username",g.name),g=b,c(a)},function(a){return this.logout(),c(a)}.bind(this)).$promise},changePassword:function(a,b,c){var e=c||angular.noop;return d.changePassword({id:g.id},{oldPassword:a,newPassword:b},function(a){return e(a)},function(a){return e(a)}).$promise},getCurrentUser:function(){return g},isLoggedIn:function(){return g.hasOwnProperty("name")},isLoggedInAsync:function(a){g.hasOwnProperty("$promise")?g.$promise.then(function(){a(!0)})["catch"](function(){a(!1)}):a(g.hasOwnProperty("name")?!0:!1)},isAdmin:function(){return"ROLE_ADMIN"===g.permission},getToken:function(){return e.get("token")}}}]),angular.module("foobotApp").factory("User",["$resource",function(a){return a("/api/v2/user/:id/:controller/",{id:"@_id"},{create:{method:"POST",params:{controller:"create"}},changePassword:{method:"PUT",params:{controller:"password"}}})}]),angular.module("foobotApp").directive("carbon",function(){return{restrict:"E",scope:{data:"="},link:function(a,b){a.$watch("data",function(b){return a.render(b)},!0),a.render=function(a){if(void 0===a)return!1;var c=[],d=$(".col-sm-12").width(),e=550,f=200,g=d/2;g>e&&(g=e),f>g&&(g=f);for(var h={top:20,right:0,bottom:30,left:50},i=d-h.left-h.right,j=g-h.top-h.bottom,k=0;k<a.length;k++)c[k]={},c[k].date=moment.unix(a[k][0]).toDate(),c[k].value=a[k][4];var l=d3.time.scale().range([0,i]),m=d3.scale.linear().range([j,0]),n=d3.svg.axis().scale(l).ticks(5).orient("bottom"),o=d3.svg.axis().scale(m).orient("left"),p=d3.svg.area().x(function(a){return l(a.date)}).y0(j).y1(function(a){return m(a.value)}),q=d3.select(b[0]).append("svg").attr("width",i+h.left+h.right).attr("height",j+h.top+h.bottom).append("g").attr("transform","translate("+h.left+","+h.top+")"),r=q.append("defs").append("linearGradient").attr({id:"carbon-grad",x1:"0%",x2:"0%",y1:"100%",y2:"0%",gradientUnits:"userSpaceOnUse"});r.append("stop").attr("offset","0%").style("stop-color","#40d47e"),r.append("stop").attr("offset","19.5%").style("stop-color","#40d47e"),r.append("stop").attr("offset","19.5%").style("stop-color","#e67e22"),r.append("stop").attr("offset","50%").style("stop-color","#e67e22"),r.append("stop").attr("offset","50%").style("stop-color","#e74c3c"),r.append("stop").attr("offset","100%").style("stop-color","#e74c3c"),l.domain(d3.extent(c,function(a){return a.date})),m.domain([0,1e4]),q.append("path").datum(c).attr("class","carbon-area area").attr("fill","url("+location.href+"#carbon-grad)").attr("d",p),q.append("g").attr("class","x axis").attr("transform","translate(0,"+j+")").call(n),q.append("g").attr("class","y axis").call(o).append("text").attr("transform","rotate(-90)").attr("y",6).attr("dy",".71em").style("text-anchor","end").text("Concentration (ppm)");var s=d3.select(b[0]).append("div").attr("class","graph-tooltip"),t=d3.select(b[0]).append("div").attr("class","vertical-bar").style("height",j+"px").style("bottom",h.bottom+5+"px"),u=d3.bisector(function(a){return a.date}).left;d3.select(".carbon-area").on("mousemove",function(a,b){var d=d3.mouse(this)[0],e=l.invert(d),b=u(c,e,1),f=c[b-1],g=c[b],a=d-f[0]>g[0]-d?g:f,i=Math.round(100*a.value)/100;t.style("left",d+h.left+"px");var k=s.style("width");k=k.substr(0,k.length-2),s.style("left",d+h.left-k/2+"px"),s.style("bottom",j-m(a.value)+h.bottom+5+"px"),d3.select(this).classed("hover",!0).attr("stroke","white").attr("stroke-width","0.5px"),s.html('<div class="tooltip-arrow"></div><div class="tooltip-inner"><p>'+i+" ppm<br>"+moment(e).format("LLLL")+"</p></div>").style("visibility","visible")})}}}}),angular.module("foobotApp").directive("humidity",function(){return{restrict:"E",scope:{data:"="},link:function(a,b){a.$watch("data",function(b){return a.render(b)},!0),a.render=function(a){if(void 0===a)return!1;var c=[],d=$(".col-sm-12").width(),e=550,f=200,g=d/2;g>e&&(g=e),f>g&&(g=f);for(var h={top:20,right:0,bottom:30,left:40},i=d-h.left-h.right,j=g-h.top-h.bottom,k=0;k<a.length;k++)c[k]={},c[k].date=moment.unix(a[k][0]).toDate(),c[k].value=a[k][3];var l=d3.time.scale().range([0,i]),m=d3.scale.linear().range([j,0]),n=d3.svg.axis().scale(l).ticks(5).orient("bottom"),o=d3.svg.axis().scale(m).orient("left"),p=d3.svg.area().x(function(a){return l(a.date)}).y0(j).y1(function(a){return m(a.value)}),q=d3.select(b[0]).append("svg").attr("width",i+h.left+h.right).attr("height",j+h.top+h.bottom).append("g").attr("transform","translate("+h.left+","+h.top+")"),r=q.append("defs").append("linearGradient").attr({id:"humidity-grad",x1:"0%",x2:"0%",y1:"100%",y2:"0%",gradientUnits:"userSpaceOnUse"});r.append("stop").attr("offset","0%").style("stop-color","#e74c3c"),r.append("stop").attr("offset","46.7%").style("stop-color","#e74c3c"),r.append("stop").attr("offset","46.7%").style("stop-color","#e67e22"),r.append("stop").attr("offset","55.4%").style("stop-color","#e67e22"),r.append("stop").attr("offset","55.4%").style("stop-color","#40d47e"),r.append("stop").attr("offset","64.4%").style("stop-color","#40d47e"),r.append("stop").attr("offset","64.4%").style("stop-color","#e67e22"),r.append("stop").attr("offset","73.7%").style("stop-color","#e67e22"),r.append("stop").attr("offset","73.7%").style("stop-color","#e74c3c"),r.append("stop").attr("offset","100%").style("stop-color","#e74c3c"),l.domain(d3.extent(c,function(a){return a.date})),m.domain([0,100]),q.append("path").datum(c).attr("class","humidity-area area").attr("fill","url("+location.href+"#humidity-grad)").attr("d",p),q.append("g").attr("class","x axis").attr("transform","translate(0,"+j+")").call(n),q.append("g").attr("class","y axis").call(o).append("text").attr("transform","rotate(-90)").attr("y",6).attr("dy",".71em").style("text-anchor","end").text("Percentage (%)");var s=d3.select(b[0]).append("div").attr("class","graph-tooltip"),t=d3.select(b[0]).append("div").attr("class","vertical-bar").style("height",j+"px").style("bottom",h.bottom+5+"px"),u=d3.bisector(function(a){return a.date}).left;d3.select(".humidity-area").on("mousemove",function(a,b){var d=d3.mouse(this)[0],e=l.invert(d),b=u(c,e,1),f=c[b-1],g=c[b],a=d-f[0]>g[0]-d?g:f,i=Math.round(100*a.value)/100;t.style("left",d+h.left+"px");var k=s.style("width");k=k.substr(0,k.length-2),s.style("left",d+h.left-k/2+"px"),s.style("bottom",j-m(a.value)+h.bottom+5+"px"),d3.select(this).classed("hover",!0).attr("stroke","white").attr("stroke-width","0.5px"),s.html('<div class="tooltip-arrow"></div><div class="tooltip-inner"><p>'+i+" %<br>"+moment(e).format("LLLL")+"</p></div>").style("visibility","visible")})}}}}),angular.module("foobotApp").directive("gauge",function(){return{restrict:"A",scope:{data:"="},link:function(a,b){var c=liquidFillGaugeDefaultSettings();c.waveAnimateTime=1500;var d=loadLiquidFillGauge(b[0].id,0,c);a.$watch("data",function(b){return a.render(b)},!0),a.render=function(a){a&&d.update(a)}}}}),angular.module("foobotApp").directive("temperature",function(){return{restrict:"E",scope:{data:"="},link:function(a,b){a.$watch("data",function(b){return a.render(b)},!0),a.render=function(a){if(void 0===a)return!1;var c=[],d=$(".col-sm-12").width(),e=550,f=200,g=d/2;g>e&&(g=e),f>g&&(g=f);for(var h={top:10,right:0,bottom:20,left:30},i=d-h.left-h.right,j=g-h.top-h.bottom,k=0;k<a.length;k++)c[k]={},c[k].date=moment.unix(a[k][0]).toDate(),c[k].value=a[k][2];var l=d3.time.scale().range([0,i]),m=d3.scale.linear().range([j,0]),n=d3.time.format.multi([[".%L",function(a){return a.getMilliseconds()}],[":%S",function(a){return a.getSeconds()}],["%H:%M",function(a){return a.getMinutes()}],["%Hh",function(a){return a.getHours()}],["%a %d",function(a){return a.getDay()&&1!==a.getDate()}],["%b %d",function(a){return 1!==a.getDate()}],["%B",function(a){return a.getMonth()}],["%Y",function(){return!0}]]),o=d3.svg.axis().scale(l).ticks(5).tickFormat(n).orient("bottom"),p=d3.svg.axis().scale(m).orient("left"),q=d3.svg.area().x(function(a){return l(a.date)}).y0(j).y1(function(a){return m(a.value)}),r=d3.select(b[0]).append("svg").attr("width",i+h.left+h.right).attr("height",j+h.top+h.bottom).append("g").attr("transform","translate("+h.left+","+h.top+")"),s=r.append("defs").append("linearGradient").attr({id:"temperature-grad",x1:"0%",x2:"0%",y1:"100%",y2:"0%",gradientUnits:"userSpaceOnUse"});s.append("stop").attr("offset","0%").style("stop-color","#e74c3c"),s.append("stop").attr("offset","44.15%").style("stop-color","#e74c3c"),s.append("stop").attr("offset","44.15%").style("stop-color","#e67e22"),s.append("stop").attr("offset","56.4%").style("stop-color","#e67e22"),s.append("stop").attr("offset","56.4%").style("stop-color","#40d47e"),s.append("stop").attr("offset","70%").style("stop-color","#40d47e"),s.append("stop").attr("offset","70%").style("stop-color","#e67e22"),s.append("stop").attr("offset","80%").style("stop-color","#e67e22"),s.append("stop").attr("offset","80%").style("stop-color","#e74c3c"),s.append("stop").attr("offset","100%").style("stop-color","#e74c3c"),l.domain(d3.extent(c,function(a){return a.date})),m.domain([0,40]),r.append("path").datum(c).attr("class","temperature-area area").attr("fill","url("+location.href+"#temperature-grad)").attr("d",q),r.append("g").attr("class","x axis").attr("transform","translate(0,"+j+")").call(o),r.append("g").attr("class","y axis").call(p).append("text").attr("transform","rotate(-90)").attr("y",6).attr("dy",".71em").style("text-anchor","end").text("Degree (°C)");var t=d3.select(b[0]).append("div").attr("class","graph-tooltip"),u=d3.select(b[0]).append("div").attr("class","vertical-bar").style("height",j+"px").style("bottom",h.bottom+5+"px"),v=d3.bisector(function(a){return a.date}).left;d3.select(".temperature-area").on("mousemove",function(a,b){var d=d3.mouse(this)[0],e=l.invert(d),b=v(c,e,1),f=c[b-1],g=c[b],a=d-f[0]>g[0]-d?g:f,i=Math.round(100*a.value)/100;u.style("left",d+h.left+"px");var k=t.style("width");k=k.substr(0,k.length-2),t.style("left",d+h.left-k/2+"px"),t.style("bottom",j-m(a.value)+h.bottom+5+"px"),d3.select(this).classed("hover",!0).attr("stroke","white").attr("stroke-width","0.5px"),t.html('<div class="tooltip-arrow"></div><div class="tooltip-inner"><p>'+i+"°C<br>"+moment(e).format("LLLL")+"</p></div>").style("visibility","visible")})}}}}),angular.module("foobotApp").directive("total",function(){return{restrict:"E",scope:{data:"="},link:function(a,b){a.$watch("data",function(b){return a.render(b)},!0),a.render=function(a){if(void 0===a)return!1;var c=[],d=$(".col-sm-12").width(),e=550,f=200,g=d/2;g>e&&(g=e),f>g&&(g=f);for(var h={top:20,right:0,bottom:30,left:40},i=d-h.left-h.right,j=g-h.top-h.bottom,k=0;k<a.length;k++)c[k]={},c[k].date=moment.unix(a[k][0]).toDate(),c[k].value=a[k][6];var l=d3.time.scale().range([0,i]),m=d3.scale.linear().range([j,0]),n=d3.svg.axis().scale(l).ticks(5).orient("bottom"),o=d3.svg.axis().scale(m).orient("left"),p=d3.svg.area().x(function(a){return l(a.date)}).y0(j).y1(function(a){return m(a.value)}),q=d3.select(b[0]).append("svg").attr("width",i+h.left+h.right).attr("height",j+h.top+h.bottom).append("g").attr("transform","translate("+h.left+","+h.top+")"),r=q.append("defs").append("linearGradient").attr({id:"total-grad",x1:"0%",x2:"0%",y1:"100%",y2:"0%",gradientUnits:"userSpaceOnUse"});r.append("stop").attr("offset","0%").style("stop-color","#40d47e"),r.append("stop").attr("offset","40%").style("stop-color","#40d47e"),r.append("stop").attr("offset","40%").style("stop-color","#e67e22"),r.append("stop").attr("offset","58.5%").style("stop-color","#e67e22"),r.append("stop").attr("offset","58.5%").style("stop-color","#e74c3c"),r.append("stop").attr("offset","100%").style("stop-color","#e74c3c"),l.domain(d3.extent(c,function(a){return a.date})),m.domain([0,150]),q.append("path").datum(c).attr("class","total-area area").attr("fill","url("+location.href+"#total-grad)").attr("d",p),q.append("g").attr("class","x axis").attr("transform","translate(0,"+j+")").call(n),q.append("g").attr("class","y axis").call(o).append("text").attr("transform","rotate(-90)").attr("y",6).attr("dy",".71em").style("text-anchor","end").text("Percentage (%)");var s=d3.select(b[0]).append("div").attr("class","graph-tooltip"),t=d3.select(b[0]).append("div").attr("class","vertical-bar").style("height",j+"px").style("bottom",h.bottom+5+"px"),u=d3.bisector(function(a){return a.date}).left;d3.select(".total-area").on("mousemove",function(a,b){var d=d3.mouse(this)[0],e=l.invert(d),b=u(c,e,1),f=c[b-1],g=c[b],a=d-f[0]>g[0]-d?g:f,i=Math.round(100*a.value)/100;t.style("left",d+h.left+"px");var k=s.style("width");k=k.substr(0,k.length-2),s.style("left",d+h.left-k/2+"px"),s.style("bottom",j-m(a.value)+h.bottom+5+"px"),d3.select(this).classed("hover",!0).attr("stroke","white").attr("stroke-width","0.5px"),s.html('<div class="tooltip-arrow"></div><div class="tooltip-inner"><p>'+i+" %<br>"+moment(e).format("LLLL")+"</p></div>").style("visibility","visible")})}}}}),angular.module("foobotApp").directive("voc",function(){return{restrict:"E",scope:{data:"="},link:function(a,b){a.$watch("data",function(b){return a.render(b)},!0),a.render=function(a){if(void 0===a)return!1;var c=[],d=$(".col-sm-12").width(),e=550,f=200,g=d/2;g>e&&(g=e),f>g&&(g=f);for(var h={top:20,right:0,bottom:30,left:50},i=d-h.left-h.right,j=g-h.top-h.bottom,k=0;k<a.length;k++)c[k]={},c[k].date=moment.unix(a[k][0]).toDate(),c[k].value=a[k][5];var l=d3.time.scale().range([0,i]),m=d3.scale.linear().range([j,0]),n=d3.svg.axis().scale(l).ticks(5).orient("bottom"),o=d3.svg.axis().scale(m).orient("left"),p=d3.svg.area().x(function(a){return l(a.date)}).y0(j).y1(function(a){return m(a.value)}),q=d3.select(b[0]).append("svg").attr("width",i+h.left+h.right).attr("height",j+h.top+h.bottom).append("g").attr("transform","translate("+h.left+","+h.top+")"),r=q.append("defs").append("linearGradient").attr({id:"voc-grad",x1:"0%",x2:"0%",y1:"100%",y2:"0%",gradientUnits:"userSpaceOnUse"});r.append("stop").attr("offset","0%").style("stop-color","#2ecc71"),r.append("stop").attr("offset","33%").style("stop-color","#2ecc71"),r.append("stop").attr("offset","33%").style("stop-color","#e67e22"),r.append("stop").attr("offset","55.25%").style("stop-color","#e67e22"),r.append("stop").attr("offset","55.25%").style("stop-color","#e74c3c"),r.append("stop").attr("offset","100%").style("stop-color","#e74c3c"),l.domain(d3.extent(c,function(a){return a.date})),m.domain([0,1e3]),q.append("path").datum(c).attr("class","voc-area area").attr("fill","url("+location.href+"#voc-grad)").attr("d",p),q.append("g").attr("class","x axis").attr("transform","translate(0,"+j+")").call(n),q.append("g").attr("class","y axis").call(o).append("text").attr("transform","rotate(-90)").attr("y",6).attr("dy",".71em").style("text-anchor","end").text("Concentration (ppb)");var s=d3.select(b[0]).append("div").attr("class","graph-tooltip"),t=d3.select(b[0]).append("div").attr("class","vertical-bar").style("height",j+"px").style("bottom",h.bottom+5+"px"),u=d3.bisector(function(a){return a.date}).left;d3.select(".voc-area").on("mousemove",function(a,b){var d=d3.mouse(this)[0],e=l.invert(d),b=u(c,e,1),f=c[b-1],g=c[b],a=d-f[0]>g[0]-d?g:f,i=Math.round(100*a.value)/100;t.style("left",d+h.left+"px");var k=s.style("width");k=k.substr(0,k.length-2),s.style("left",d+h.left-k/2+"px"),s.style("bottom",j-m(a.value)+h.bottom+5+"px"),d3.select(this).classed("hover",!0).attr("stroke","white").attr("stroke-width","0.5px"),s.html('<div class="tooltip-arrow"></div><div class="tooltip-inner"><p>'+i+" ppb<br>"+moment(e).format("LLLL")+"</p></div>").style("visibility","visible")})}}}}),angular.module("foobotApp").directive("dbmodelError",function(){return{restrict:"A",require:"ngModel",link:function(a,b,c,d){b.on("keydown",function(){return d.$setValidity("dbmodel",!0)})}}}),angular.module("foobotApp").factory("Data",["$resource",function(a){return a("/api/v2/device/:uuid/datapoint/:period/last/:sampling/",{uuid:"@_uuid",period:"@_period",sampling:"@_sampling"},{get:{method:"GET"}})}]),angular.module("foobotApp").factory("Device",["$resource",function(a){return a("/api/v2/owner/:id/device/",{id:"@_id"},{getDevices:{method:"GET",isArray:!0}})}]),angular.module("foobotApp").factory("Graph",["$resource",function(a){return a("/api/v2/device/:uuid/datapoint/:start/:end/:sampling/",{uuid:"@_uuid",start:"@_start",end:"@_end",sampling:"@_sampling"},{get:{method:"GET"}})}]),angular.module("foobotApp").controller("NavbarCtrl",["$scope","$location","Auth","Device","gettextCatalog",function(a,b,c,d,e){a.menu=[{title:e.getString("Home"),link:"/"}],a.isLoggedIn=c.isLoggedIn,a.isAdmin=c.isAdmin,a.getCurrentUser=c.getCurrentUser,a.isLoggedIn()&&d.getDevices({id:a.getCurrentUser().name},function(b){for(var c=0;c<b.length;c++)a.menu.push({title:b[c].name,link:"/devices/"+b[c].uuid})},function(a){console.log(a)}),a.logout=function(){c.logout(),b.path("/login")},a.isActive=function(a){return a===b.path()}}]),angular.module("gettext").run(["gettextCatalog",function(a){a.setStrings("fr",{"A name is required":"Un nom est requis","Carbon dioxide":"Dioxyde de carbone","Doesn't look like a valid email.":"Ne ressemble pas à une adresse e-mail valide.",Email:"Adresse e-mail","Foobot dashboard":"Tableau de bord Foobot","Foobot is a smart device designed to help you take control of your indoor air quality.":"Foobot est un appareil connecté conçu pour vous aider à prendre le contrôle sur la qualité de votre air d'intérieur.","Hello {{ getCurrentUser().name }}":"Bonjour {{ getCurrentUser().name }}",Home:"Accueil",Humidity:"Humidité","Last updated {{ time }}":"Dernière mise à jour {{ time }}",Login:"Connexion",Logout:"Déconnexion",Name:"Nom","Particulate matter":"Particules fines",Password:"Mot de passe","Password must be at least 3 characters.":"Le mot de passe doit comporter au moins 3 caractères.","Please enter a valid email.":"Veuillez saisir une adresse e-mail valide.","Please enter your email and password.":"Veuillez saisir une adresse e-mail et un mot de passe.","Pollution level":"Niveau de pollution",Register:"S'inscrire","Sign up":"Inscription",Temperature:"Température","Toggle navigation":"Activer la navigation","Volatile Organic Compound":"Composé Organique Volatile","What's your email address?":"Quelle est votre adresse email ?"})}]),angular.module("foobotApp").run(["$templateCache",function(a){a.put("app/account/login/login.html",'<div ng-include="\'components/navbar/navbar.html\'"></div><div class=container><div class=row><div class=col-sm-12><h1 translate>Login</h1></div><div class=col-sm-12><form class=form name=form ng-submit=login(form) novalidate><div class=form-group><label translate>Email</label><input type=email name=email class=form-control ng-model=user.email required></div><div class=form-group><label translate>Password</label><input type=password name=password class=form-control ng-model=user.password required></div><div class="form-group has-error"><p class=help-block ng-show="form.email.$error.required && form.password.$error.required && submitted" translate>Please enter your email and password.</p><p class=help-block ng-show="form.email.$error.email && submitted" translate>Please enter a valid email.</p><p class=help-block>{{ errors.other }}</p></div><div><button class="btn btn-inverse btn-lg btn-login" type=submit translate>Login</button> <a class="btn btn-default btn-lg btn-register" href=/signup translate>Register</a></div></form></div></div><hr></div>'),a.put("app/account/settings/settings.html",'<div ng-include="\'components/navbar/navbar.html\'"></div><div class=container><div class=row><div class=col-sm-12><h1>Change Password</h1></div><div class=col-sm-12><form class=form name=form ng-submit=changePassword(form) novalidate><div class=form-group><label>Current Password</label><input type=password name=password class=form-control ng-model=user.oldPassword dbmodel-error><p class=help-block ng-show=form.password.$error.dbmodel>{{ errors.other }}</p></div><div class=form-group><label>New Password</label><input type=password name=newPassword class=form-control ng-model=user.newPassword ng-minlength=3 required><p class=help-block ng-show="(form.newPassword.$error.minlength || form.newPassword.$error.required) && (form.newPassword.$dirty || submitted)">Password must be at least 3 characters.</p></div><p class=help-block>{{ message }}</p><button class="btn btn-lg btn-primary" type=submit>Save changes</button></form></div></div></div>'),a.put("app/account/signup/signup.html",'<div ng-include="\'components/navbar/navbar.html\'"></div><div class=container><div class=row><div class=col-sm-12><h1 translate>Sign up</h1></div><div class=col-sm-12><form class=form name=form ng-submit=register(form) novalidate><div class=form-group ng-class="{ \'has-success\': form.name.$valid && submitted,\r\n                                            \'has-error\': form.name.$invalid && submitted }"><label translate>Name</label><input name=name class=form-control ng-model=user.name required><p class=help-block ng-show="form.name.$error.required && submitted" translate>A name is required</p></div><div class=form-group ng-class="{ \'has-success\': form.email.$valid && submitted,\r\n                                            \'has-error\': form.email.$invalid && submitted }"><label translate>Email</label><input type=email name=email class=form-control ng-model=user.email required dbmodel-error><p class=help-block ng-show="form.email.$error.email && submitted" translate>Doesn\'t look like a valid email.</p><p class=help-block ng-show="form.email.$error.required && submitted" translate>What\'s your email address?</p><p class=help-block ng-show=form.email.$error.dbmodel>{{ errors.email }}</p></div><div class=form-group ng-class="{ \'has-success\': form.password.$valid && submitted,\r\n                                            \'has-error\': form.password.$invalid && submitted }"><label translate>Password</label><input type=password name=password class=form-control ng-model=user.password ng-minlength=3 required dbmodel-error><p class=help-block ng-show="(form.password.$error.minlength || form.password.$error.required) && submitted" translate>Password must be at least 3 characters.</p><p class=help-block ng-show=form.password.$error.dbmodel>{{ errors.password }}</p></div><div><button class="btn btn-inverse btn-lg btn-login" type=submit translate>Sign up</button> <a class="btn btn-default btn-lg btn-register" href=/login translate>Login</a></div></form></div></div><hr></div>'),
a.put("app/admin/admin.html",'<div ng-include="\'components/navbar/navbar.html\'"></div><div class=container><p>The delete user and user index api routes are restricted to users with the \'admin\' role.</p><ul class=list-group><li class=list-group-item ng-repeat="user in users"><strong>{{user.name}}</strong><br><span class=text-muted>{{user.email}}</span> <a ng-click=delete(user) class=trash><span class="glyphicon glyphicon-trash pull-right"></span></a></li></ul></div>'),a.put("app/devices/devices.html",'<div ng-include="\'components/navbar/navbar.html\'"></div><div class=container><div class=pull-right><div translate>Last updated {{ time }}</div></div><h2 style="text-align: center" translate>Pollution level</h2><svg id=allpollu gauge data=allpollu.value></svg><div class=col-sm-6><h2 translate>Temperature</h2><div>{{ tmp.value }} °C</div></div><div class=col-sm-6><h2 translate>Humidity</h2><div>{{ hum.value }} <span>%</span></div></div><div class=col-sm-6><h2 translate>Particulate matter</h2><div>{{ pm.value }} ug/m<sup>3</sup></div></div><div class=col-sm-6><h2 translate>Carbon dioxide</h2><div>{{ co2.value }} <span>{{ co2.unit }}</span></div></div><div class=col-sm-6><h2 translate>Volatile Organic Compound</h2><div>{{ voc.value }} <span>{{ voc.unit }}</span></div></div><div class=col-sm-12><h2 translate>Temperature</h2><temperature data=graphData></temperature></div><div class=col-sm-12><h2 translate>Carbon dioxide</h2><carbon data=graphData></carbon></div><div class=col-sm-12><h2 translate>Humidity</h2><humidity data=graphData></humidity></div><div class=col-sm-12><h2 translate>Volatile Organic Compound</h2><voc data=graphData></voc></div><div class=col-sm-12><h2 translate>Pollution level</h2><total data=graphData></total></div></div>'),a.put("app/main/main.html","<div ng-include=\"'components/navbar/navbar.html'\"></div><header class=hero-unit id=banner><div class=container><h1>'Allo, 'Allo Foobot!</h1><p class=lead translate>Foobot is a smart device designed to help you take control of your indoor air quality.</p></div></header><footer class=footer><div class=container><p><span translate>Foobot dashboard</span> v0.1.0 | <a href=https://twitter.com/DavidRouyer>@DavidRouyer</a></p></div></footer>"),a.put("components/navbar/navbar.html",'<div class="navbar navbar-default navbar-static-top" ng-controller=NavbarCtrl><div class=container><div class=navbar-header><button class=navbar-toggle type=button data-toggle=collapse href=#navbar-main><span class=sr-only translate>Toggle navigation</span> <span class=icon-bar></span> <span class=icon-bar></span> <span class=icon-bar></span></button> <a href="/" class=navbar-brand>Foobot</a></div><div class="navbar-collapse collapse" id=navbar-main><ul class="nav navbar-nav"><li ng-repeat="item in menu" ng-class="{active: isActive(item.link)}"><a ng-href={{item.link}}>{{item.title}}</a></li><li ng-show=isAdmin() ng-class="{active: isActive(\'/admin\')}"><a href=/admin>Admin</a></li></ul><ul class="nav navbar-nav navbar-right"><li ng-hide=isLoggedIn() ng-class="{active: isActive(\'/signup\')}"><a href=/signup translate>Sign up</a></li><li ng-hide=isLoggedIn() ng-class="{active: isActive(\'/login\')}"><a href=/login translate>Login</a></li><li ng-show=isLoggedIn()><p class=navbar-text translate>Hello {{ getCurrentUser().name }}</p></li><!--li ng-show="isLoggedIn()" ng-class="{active: isActive(\'/settings\')}"><a href="/settings"><span class="glyphicon glyphicon-cog"></span></a></li--><li ng-show=isLoggedIn() ng-class="{active: isActive(\'/logout\')}"><a href="" ng-click=logout() translate>Logout</a></li></ul></div></div></div>')}]);